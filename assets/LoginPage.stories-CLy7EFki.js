import{r as a,u as v,j as e}from"./iframe-BXIlaz2d.js";import{a as j,u as L}from"./client-Chm_LENq.js";import{u as _}from"./useMutation-JYB7MqBB.js";import{w as N}from"./decorators-Cos6l-TR.js";import"./preload-helper-ByZkdcDp.js";const b={oauthLogin:async(r,t)=>(await j.post(`/auth/oauth/${r}`,t)).data,login:async r=>(await j.post("/auth/login",r)).data,logout:()=>{localStorage.removeItem("accessToken")},isAuthenticated:()=>!!localStorage.getItem("accessToken")};var k={};const I=()=>{const[r,t]=a.useState(!1),[p,l]=a.useState(""),[f,c]=a.useState(""),[i,m]=a.useState(!1),u=`${window.location.origin}/api/auth/google`,g=a.useCallback(()=>{const o=k.NEXT_PUBLIC_GOOGLE_CLIENT_ID;if(!o){c("Google Client ID가 설정되지 않았습니다.");return}const s=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${o}&redirect_uri=${encodeURIComponent(u)}&response_type=code&scope=openid%20email%20profile`;console.log("구글 로그인 URL:",s),console.log("Redirect URI:",u),window.location.href=s},[]),x=a.useCallback(()=>{t(!1),l(""),c(""),document.cookie.split(";").forEach(o=>{const s=o.split("=")[0].trim();document.cookie=`${s}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}),localStorage.removeItem("userToken"),sessionStorage.clear()},[]),y=a.useCallback(async o=>{try{c(""),m(!0);const s=k.NEXT_PUBLIC_BACKEND_API_URL+"/oauth/login/google",n=await fetch(`${s}?code=${o}&redirect_uri=${encodeURIComponent(u)}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(n.ok){const d=await n.json(),w=(d.token||d.accessToken||d.access_token||"token_received").access_token;l(w),t(!0),localStorage.setItem("userToken",w),window.location.href="/main"}else{const d=await n.text();throw new Error(`로그인 실패: ${n.status} - ${d}`)}}catch(s){console.error("OAuth 로그인 오류:",s),c(s instanceof Error?s.message:"로그인 처리 중 오류가 발생했습니다."),setTimeout(()=>{window.location.href="/login"},3e3)}finally{m(!1)}},[]);return{login:g,logout:x,isLoggedIn:r,userToken:p,error:f,isProcessing:i,handleOAuthCallback:y}},T=()=>{const r=L();return _({mutationFn:t=>b.login(t),onSuccess:()=>{r.invalidateQueries({queryKey:["user"]})}})};function C(){const r=v(),[t,p]=a.useState(""),[l,f]=a.useState(""),[c,i]=a.useState(""),{login:m}=I(),u=T();a.useEffect(()=>{document.cookie.split(";").forEach(s=>{const n=s.split("=")[0].trim();document.cookie=`${n}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}),localStorage.removeItem("accessToken"),localStorage.removeItem("userToken"),sessionStorage.clear()},[]);const g=async s=>{if(s.preventDefault(),!t||!l){i("아이디와 비밀번호를 모두 입력해주세요.");return}i("");try{await u.mutateAsync({username:t,password:l}),console.log("Login successful"),r.push("/main")}catch(n){console.error("Login error:",n),i(n.response?.data?.error||n.message||"로그인에 실패했습니다.")}},x=()=>{m()},y=t.trim()!==""&&l.trim()!=="",o=u.isPending;return e.jsxs("div",{className:"bg-white flex flex-col h-screen mx-auto",style:{width:"var(--app-width)"},children:[e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:[e.jsx("div",{className:"flex items-center justify-center py-6 mb-6",children:e.jsx("h1",{className:"headline-1 text-primary",children:"LOGO"})}),e.jsxs("form",{onSubmit:g,className:"flex flex-col gap-2 w-full",children:[e.jsx("input",{type:"text",value:t,onChange:s=>{p(s.target.value),i("")},placeholder:"아이디",className:`field w-full h-11 ${c?"field-error":""}`,disabled:o}),e.jsx("input",{type:"password",value:l,onChange:s=>{f(s.target.value),i("")},placeholder:"비밀번호",className:`field w-full h-11 ${c?"field-error":""}`,disabled:o}),c&&e.jsx("p",{className:"field-error-text",children:c})]}),e.jsx("button",{onClick:g,disabled:!y||o,className:"btn btn-primary w-full mt-6",children:o?"로그인 중...":"로그인"}),e.jsx("div",{className:"label-1 text-on-surface-subtle my-6",children:"또는"}),e.jsxs("button",{onClick:x,className:"btn btn-default-tertiary w-full",style:{paddingLeft:"12px",paddingRight:"16px"},disabled:o,children:[e.jsx("div",{className:"w-6 h-6 shrink-0",children:e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-full h-full",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]})}),e.jsx("span",{className:"body-2-medium ml-3",children:"Google 계정으로 계속하기"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1 px-4 py-8 label-1 text-on-surface-subtle",children:[e.jsx("a",{href:"/forgot-password",className:"underline",children:"비밀번호 찾기"}),e.jsx("span",{children:"・"}),e.jsx("a",{href:"/signup",className:"underline",children:"회원가입"})]})]})}C.__docgenInfo={description:"",methods:[],displayName:"LoginPage"};const D={title:"Pages/Auth/LoginPage",component:C,decorators:[N],parameters:{layout:"fullscreen",nextjs:{appDirectory:!0}},tags:["autodocs"]},h={parameters:{docs:{description:{story:"로그인 페이지 - 사용자가 로그인할 수 있는 화면입니다."}}}};h.parameters={...h.parameters,docs:{...h.parameters?.docs,source:{originalSource:`{
  parameters: {
    docs: {
      description: {
        story: '로그인 페이지 - 사용자가 로그인할 수 있는 화면입니다.'
      }
    }
  }
}`,...h.parameters?.docs?.source}}};const O=["Default"];export{h as Default,O as __namedExportsOrder,D as default};
